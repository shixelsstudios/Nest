define(["jquery","underscore","backbone","views/movieCardView","views/miniMovieCardView","views/tvCardView","views/movieView","views/reviewView","views/BornTodayView"],function($,e,i,t,a,s,r,o,l){var n=i.Model.extend({defaults:{movie_api:"https://yts.to/api/v2/",tv_api:"http://filmtrik-media-apita-47113.onmodulus.net/",bornToday_api:"http://www.hollystock.com/developers/birthdays/JSON"},initialize:function(){e.bindAll(this)},stream:function(e,i,t){var a=this,s=User.getIdentity();console.log(t),$.ajax({url:this.get("tv_api")+"stream?hash="+e+"&type="+i+"&user="+s.data.email+"&size_bytes="+t,type:"get",success:function(e){console.log(e);var i=document.createElement("video"),t,s=a.get("tv_api")+e;console.log(s),i.src=s,i.autoplay=!0,i.controls=!0,$(".watch-video").html(i),i.play(),$(i).get()[0].addEventListener("loadeddata",function(){i.play()}),$(i).get()[0].addEventListener("pause",function(){i.play()})}})},search:function(e){for(var i=0;i<e.length;i++){var r=e[i];if("movies"===r.type?r.url=this.get("movie_api")+"list_movies.json?":"shows"===r.type?r.url=this.get("tv_api")+"shows/1?":"all"===r.type&&(r.all_url1=this.get("movie_api")+"list_movies.json?"),r.endpoints){r.url_endpoints=[],r.url_endpoints2=[];for(var o=0;o<r.endpoints.length;o++)for(var l in r.endpoints[o]){if("query_term"===l){var n=r.endpoints[o][l];"all"===r.type?r.all_url2=this.get("tv_api")+"shows/search/"+n+"/1?":"shows"===r.type&&(r.url=this.get("tv_api")+"shows/search/"+n+"/1?")}if("all"===r.type&&"sort_by"===l){if(r.endpoints[o][l]="seeds")var d="updated";else if(r.endpoints[o][l]="title")var d="name";var c="sort",m="&"+c+"="+d}var h="&"+l+"="+r.endpoints[o][l];r.url_endpoints.push(h)}r.url_endpoints2.push(m),"all"===r.type?(r.all_url1=r.all_url1+r.url_endpoints.join(""),r.all_url2=r.all_url2+r.url_endpoints2.join("")):r.url=r.url+r.url_endpoints.join("")}$(r.selector).html('<div class="loading-view"><i class="fa fa-spinner fa-pulse ft-loader"></i></div>'),"movies"===r.type?$.ajax({url:r.url,type:"get",success:function(e){if("ok"===e.status){var i=e.data;$(".total-number").html(i.movie_count),$(".number-viewing").html(i.movies.length),$(".query-term").html(n),$(".loading-view2").hide(),console.log(i),i.movies.reverse();for(var s=0;s<i.movies.length;s++){if(i.movies[s].has_info=r.has_info,r.is_mini)var o=new a({movie:i.movies[s]});else var o=new t({movie:i.movies[s]});$(r.selector).prepend(o.render().el)}$(".loading-view").hide();var l=Math.ceil(i.movie_count/i.limit)}}}):"shows"===r.type?$.ajax({url:r.url,type:"get",success:function(e){var i=e;if(i.reverse(),$(".query-term").html(n),$(".loading-view2").hide(),r.show_limit)var t=r.show_limit;else var t=i.length;for(var a=0;t>a;a++){i[a].has_info=r.has_info;var o=new s({show:i[a]});$(r.selector).prepend(o.render().el)}$(".loading-view").hide()}}):"all"===r.type&&$.ajax({url:r.all_url1,type:"get",success:function(e){if($.ajax({url:r.all_url2,type:"get",success:function(e){for(var i=e,t=0;t<i.length;t++){i[t].has_info=r.has_info;var a=new s({show:i[t]});$(r.selector).prepend(a.render().el)}}}),"ok"===e.status){var i=e.data;setTimeout(function(){var e=i.movie_count+$(".tv-card-holder").length;$(".total-number").html(e),$(".number-viewing").html($(".ft-card-big").length),$(".query-term").html(n),$(".loading-view").hide(),$(".loading-view2").hide()},500);for(var a=0;a<i.movies.length;a++){i.movies[a].has_info=r.has_info;var o=new t({movie:i.movies[a]});$(r.selector).prepend(o.render().el)}var l=Math.ceil(i.movie_count/i.limit)}}})}},details:function(e,i,t){var a=this,s=null;if("movies"===e)$.ajax({url:this.get("movie_api")+"movie_details.json?movie_id="+i+"&with_images=true&with_cast=true",type:"get",success:function(r){if(s=r.data,"ok"===r.status)if(t)$(".movie-title").html(s.title),ft.api.media.stream(s.torrents[0].hash,e,s.torrents[0].size_bytes);else{var o="idIMDB="+s.imdb_code+"&format=JSONP",l=(s.rating/2).toString().split("."),n=ft.api.core.createStars(l);$(".loading-view").hide(),$(".movie-holder").removeClass("hide").fadeIn();var d='<div class="fb-comments" data-href="http://localhost:8001/#movies/'+i+'" data-numposts="5" data-colorscheme="light" data-width="100%"></div>';$("#movie-comments").html(d),FB.XFBML.parse(document.getElementById("movie-comments")),$(".loading-view3.watch").hide(),$(".poster").html('<a href="#watch/movies/'+s.id+'"><div class="hover_play2"><i class="fa fa-play-circle-o "></i></div></a><div class="watch-movie-url"><img class="watch-movie" src="'+s.images.medium_cover_image+'"></div>'),$(".title").html(s.title),$(".watch-movie-mobile").html('<a href="#watch/movies/'+s.id+'" class="btn btn-secondary">Watch Movie</a>'),$(".star_rating").html(n),$(".movie-details-banner").css({background:"url('"+s.images.large_screenshot_image1+"')","background-position":"center"});for(var c=0;c<s.genres.length;c++)$(".genres").prepend(' <li><a href="#movies/genre/'+s.genres[c]+'">'+s.genres[c]+"</a></li>");$(".runtime").html(s.runtime+" min."),$(".rating").html(s.mpa_rating),s.description_full=jQuery.trim(s.description_full).substring(0,500).split(" ").slice(0,-1).join(" ")+"...",$(".movie_des").html(s.description_full),$(".year").html(s.year),s.yt_trailer_code&&$(".movie_trailer").html('<a class="btn btn-primary" href="#watch/trailer/'+s.id+'">View Trailer</a><a class="btn btn-secondary" href="#watch/movies/'+s.id+'">Watch Movie</a>');for(var m=0;m<s.actors.length;m++)$(".cast").append('<li><a class="pull-left" href="#search?query='+s.actors[m].name+'"><img class="actor-img" src="'+s.actors[m].small_image+'"><span class="actor-name">'+s.actors[m].name+'</span> </a><span class="actor-character pull-right">as '+s.actors[m].character_name+'</span><div class="clear-fix"></div></li>');$.ajax({data:o,url:"http://www.myapifilms.com/imdb",type:"get",dataType:"jsonp",success:function(e,t,r){if(s.imdb=e,s.imdb.directors.length>0){$(".directors").html("Director(s): ");for(var l=0;l<s.imdb.directors.length;l++)$(".directors").append('<span><a href="#search?query='+s.imdb.directors[l].name+'">'+s.imdb.directors[l].name+"</a></span> ")}if(s.imdb.writers.length>0){$(".writers").html("Writer(s): ");for(var n=0;n<s.imdb.writers.length;n++)$(".writers").append('<span><a href="#search?query='+s.imdb.writers[n].name+'">'+s.imdb.writers[n].name+"</a></span> ")}if(s.imdb.countries.length>0){$(".countries").html("Country(s): ");for(var d=0;d<s.imdb.countries.length;d++)$(".countries").append('<span><a href="#search?query='+s.imdb.countries[d]+'">'+s.imdb.countries[d]+"</a></span> ")}$.ajax({data:o,url:a.get("movie_api")+"movie_suggestions.json?movie_id="+i,type:"get",success:function(e){s.suggestions=e.data;for(var t=0;t<s.suggestions.movie_suggestions.length;t++)$(".suggestions").prepend('<li><a href="#movies/'+s.suggestions.movie_suggestions[t].id+'"><img src="'+s.suggestions.movie_suggestions[t].medium_cover_image+'"></a></li>');$.ajax({url:a.get("movie_api")+"movie_reviews.json.json?movie_id="+i,type:"get",success:function(e){if(s.reviews=e.data.reviews,s.reviews)for(var i=0;i<s.reviews.length;i++){var t=ft.moment(s.reviews[i].date_written).fromNow();s.reviews[i].date_written=t;var a="<li><h2>"+s.reviews[i].review_summary+'<span class="make-bold"><span class="author">- '+s.reviews[i].username+'</span> </h2><p class="news-time"><i class="fa fa-clock-o"></i> '+s.reviews[i].date_written+"</p></li>";$(".movie-details-reviews-holder").append(a)}s.reviews=e.data}})}})}})}}});else if("shows"===e)$.ajax({url:this.get("tv_api")+"show/"+i,type:"get",success:function(e){s=e,t&&($(".movie-title").html(s.title+" - "+sessionStorage.epTitle),sessionStorage.showHash?ft.api.media.stream(sessionStorage.showHash,"shows",null):ft.appRouter.navigate("shows",{trigger:!0})),$(".movie-holder").removeClass("hide").fadeIn();var a=(s.rating.percentage/10/2).toString().split("."),r=ft.api.core.createStars(a);$(".loading-view").hide(),$(".movie-holder").removeClass("hide").fadeIn(),$(".loading-view3.watch").hide();var o='<div class="fb-comments" data-href="http://localhost:8001/#shows/'+i+'" data-numposts="5" data-colorscheme="light" data-width="100%"></div>';if($("#show-comments").html(o),FB.XFBML.parse(document.getElementById("show-comments")),$(".title",".movie-title").html(s.title),$(".star_rating").html(r),$(".year").html(s.year),$(".movie-details-banner").css('"placeholders/banner.png"'===s.images.banner?{background:"url('"+s.images.banner+"')","background-position":"center"}:{background:"url('"+s.images.poster+"')","background-position":"center"}),s.genres)for(var l=0;l<s.genres.length;l++)$(".genres").prepend(" <li>"+s.genres[l]+"</li>");else $(".genres").prepend("Genre Unavailable");if($(".runtime").html(s.runtime+" min."),$(".rating").html(s.network),s.synopsis=jQuery.trim(s.synopsis).substring(0,650).split(" ").slice(0,-1).join(" ")+"...",$(".movie_des").html(s.synopsis),s.episodes){for(var n=ft.api.core.organizeEpisodes(s.episodes),d=n.length-1,c=0;c<n.length;c++)if(n[c]){if("ended"===s.status&&c!=d||c!=d)var m="slide_down",h="fa fa-caret-right";else var m="",h="fa fa-caret-down";if(c===d){n[c]=n[c].reverse();var p=n[c].length-1;if(n[c][p].torrents["720p"])var v='data-hash="'+n[c][p].torrents["720p"].url+'" data-showid="'+s._id+'" data-episodeid="'+n[c][p].tvdb_id+'" data-epTitle="'+n[c][p].title+'"';else if(n[c][p].torrents["420p"])var v='data-hash="'+n[c][p].torrents["420p"].url+'" data-showid="'+s._id+'" data-episodeid="'+n[c][p].tvdb_id+'" data-epTitle="'+n[c][p].title+'"';else if(n[c][p].torrents[0])var v='data-hash="'+n[c][p].torrents[0].url+'" data-showid="'+s._id+'" data-episodeid="'+n[c][p].tvdb_id+'" data-epTitle="'+n[c][p].title+'"';$(".poster").html('<a class="watch-latest " '+v+'><div class="hover_play2"><i class="fa fa-play-circle-o "></i></div></a><div class="watch-movie-url"><img class="watch-movie" src="'+s.images.poster+'"></div>')}for(var u='<li class="season">Season '+c+'<i class="collapser '+h+'"></i></li><ul class="episodes '+m+'">',g=[],f=0;f<n[c].length;f++){if(n[c][f].torrents)if(n[c][f].torrents["720p"])var v='data-hash="'+n[c][f].torrents["720p"].url+'" data-showid="'+s._id+'" data-episodeid="'+n[c][f].tvdb_id+'" data-epTitle="'+n[c][f].title+'"';else if(n[c][f].torrents["420p"])var v='data-hash="'+n[c][f].torrents["420p"].url+'" data-showid="'+s._id+'" data-episodeid="'+n[c][f].tvdb_id+'" data-epTitle="'+n[c][f].title+'"';else if(n[c][f].torrents[0])var v='data-hash="'+n[c][f].torrents[0].url+'" data-showid="'+s._id+'" data-episodeid="'+n[c][f].tvdb_id+'" data-epTitle="'+n[c][f].title+'"';if(n[c][f].overview=n[c][f].overview?n[c][f].overview:"Not Avaiable",n[c][f].title||(n[c][f].title="Unknown Title"),ft.mobile)var w="";else var w="-";if(n[c][f].title.length>15){var _=jQuery.trim(n[c][f].title).substring(0,20).split(" ").slice(0,-1).join(" ")+"...";g.push('<li class="season-ep"><h3><i class="fa fa-video-camera ep-icon"></i><span class="make_bold">Episode '+n[c][f].episode+"</span> "+w+" "+_+'<span class="play-ep unselectable" '+v+'><i class="fa fa-play-circle"></i> Play</span></h3><p class="season-ep-des">'+n[c][f].overview+"</p></li>")}else g.push('<li class="season-ep"><h3><i class="fa fa-video-camera ep-icon"></i><span class="make_bold">Episode '+n[c][f].episode+"</span> "+w+" "+n[c][f].title+'<span class="play-ep unselectable" '+v+'><i class="fa fa-play-circle"></i> Play</span></h3><p class="season-ep-des">'+n[c][f].overview+"</p></li>")}u=u+g.join("")+"</ul></li>",$(".show-details-reviews-holder").append(u),$(".shows-holder-mobile").append(u)}ft.api.core.handleEpisodes()}var b="idIMDB="+s.imdb_id+"&format=JSONP&actors=S";$.ajax({data:b,url:"http://www.myapifilms.com/imdb",type:"get",dataType:"jsonp",success:function(e,i,t){if(s.imdb=e,console.log(s),s.imdb.directors.length>0){$(".directors").html("Director(s): ");for(var a=0;a<s.imdb.directors.length;a++)$(".directors").append('<span><a href="#search?query='+s.imdb.directors[a].name+'">'+s.imdb.directors[a].name+"</a></span> ")}if(s.imdb.writers.length>0){$(".writers").html("Writer(s): ");for(var r=0;r<s.imdb.writers.length;r++)$(".writers").append('<span><a href="#search?query='+s.imdb.writers[r].name+'">'+s.imdb.writers[r].name+"</a></span> ")}if(s.imdb.countries.length>0){$(".countries").html("Country(s): ");for(var o=0;o<s.imdb.countries.length;o++)$(".countries").append('<span><a href="#search?query='+s.imdb.countries[o]+'">'+s.imdb.countries[o]+"</a></span> ")}if(s.imdb.actors.length>0)for(var l=0;l<s.imdb.actors.length;l++)s.imdb.actors[l].urlPhoto=""!==s.imdb.actors[l].urlPhoto?s.imdb.actors[l].urlPhoto:"../../img/more.jpg",$(".cast").append('<li><a class="pull-left" href="#search?query='+s.imdb.actors[l].actorName+'"><img class="actor-img" src="'+s.imdb.actors[l].urlPhoto+'"><span class="actor-name">'+s.imdb.actors[l].actorName+'</span> </a><span class="actor-character pull-right">as '+s.imdb.actors[l].character+'</span><div class="clear-fix"></div></li>')}})}});else if("trailer"===e){var r=null;return $.ajax({url:this.get("movie_api")+"movie_details.json?movie_id="+i,type:"get",async:!1,success:function(e){s=e.data,console.log(s),"ok"===e.status&&(r=s.yt_trailer_code?'<iframe title="YouTube video player" class="youtube-player" type="text/html" width="100%" height="100%" src="http://www.youtube.com/embed/'+s.yt_trailer_code+'" frameborder="0" allowFullScreen></iframe>':!1)}}),r}},bornToday:function(e){}});return n});